<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test</title>
    <!-- 引入 SockJS -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <!-- 引入 Stomp.js -->
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>WebSocket Test</h1>
<button id="connectBtn">Connect to WebSocket</button>
<button id="sendMessageBtn">Send Message</button>
<p id="output"></p>

<script>
    let socket;
    let stompClient;
    const token = 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ0ZXN0dXNlcjEiLCJyb2xlIjoiVVNFUiIsImlhdCI6MTcyNjMxMTgzNiwiZXhwIjoxNzI2MzE1NDM2fQ.oo2kkz3dkh4P2o7uoS1W1Ds6am_DJ5bnsu7mjWh9cBg';  // 在這裡放置你的 JWT Token

    // 連接 WebSocket
    document.getElementById('connectBtn').addEventListener('click', function () {
        // 使用 SockJS 建立 WebSocket 連接，帶上 Token
        socket = new SockJS('http://localhost:8080/ws?token=' + token);
        stompClient = Stomp.over(socket);

        stompClient.connect({}, function(frame) {
            console.log('Connected: ' + frame);
            document.getElementById('output').textContent = 'Connected to WebSocket';

            // 訂閱消息
            stompClient.subscribe('/user/queue/messages', function(message) {
                console.log('Received: ' + message.body);
                document.getElementById('output').textContent = 'Message: ' + message.body;
            });
        }, function(error) {
            console.log('Error: ' + error);
        });
    });

    // 發送消息
    document.getElementById('sendMessageBtn').addEventListener('click', function () {
        if (stompClient && stompClient.connected) {
            const message = JSON.stringify({
                receiverId: 'testuser',  // 目標用戶名
                message: 'Hello from WebSocket client!'  // 發送的消息
            });
            stompClient.send('/app/chat', {}, message);
            console.log('Message sent to server: ' + message);
        } else {
            console.log('WebSocket is not connected.');
        }
    });
</script>
</body>
</html>
